<!DOCTYPE html>
<html lang="en">
<head>
 

    <meta charset="UTF-8">
    <title>CR Dashboard - Attendance</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* =================== PRESERVED STYLES =================== */
        body.home-page {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(160deg, #1f1c2c, #f39c12);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            color: #fff;
        }

        .bubbles li {
            position: absolute;
            list-style: none;
            display: block;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.15);
            bottom: -150px;
            border-radius: 50%;
            animation: rise 25s infinite ease-in;
        }
        @keyframes rise {
            0% { transform: translateY(0) rotate(0deg); opacity:0;}
            50% { opacity:0.5; }
            100% { transform: translateY(-1000px) rotate(360deg); opacity:1;}
        }

        .card {
            width: 95%;
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            border-radius: 25px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.35);
        }

        .card h1 {
            font-weight: 900;
            font-size: 2.2rem;
            margin-bottom: 25px;
            text-align: center;
            color: #fff;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.4);
        }

        .selectors {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .selectors input[type="date"], .selectors .subject-pill {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            color: #fff;
            font-weight: bold;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        .selectors input[type="date"]:hover,
        .selectors .subject-pill:hover {
            background: rgba(255,255,255,0.35);
            transform: scale(1.05);
        }
        .subject-pill.active {
            background: #f39c12;
            color: #fff;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(243, 156, 18,0.7);
        }

        .table-wrapper {
            max-height: 550px;
            overflow-y: auto;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            table-layout: fixed;
            color: #fff;
        }

        .attendance-table th, .attendance-table td {
            padding: 12px 10px;
            text-align: center;
            font-weight: bold;
        }

        .attendance-table th {
            background-color: #f39c12;
            color: #fff;
            position: sticky;
            top: 0;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .attendance-table tbody tr:nth-child(even) {
            background-color: rgba(255,255,255,0.05);
        }
        .attendance-table tbody tr:nth-child(odd) {
            background-color: rgba(255,255,255,0.02);
        }
        .attendance-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .attendance-table tbody tr.marked {
            animation: slideHighlight 0.4s ease forwards;
        }
        @keyframes slideHighlight {
            0% { background-color: rgba(243, 156, 18,0.3); transform: translateX(-20px); }
            100% { background-color: rgba(255,255,255,0.02); transform: translateX(0); }
        }

        .toggle-group {
            display: flex;
            justify-content: center;
            gap: 8px;
            position: relative;
        }
        .toggle-group input[type="radio"] { display: none; }
        .toggle-group label {
            padding: 6px 16px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            min-width: 70px;
            text-align: center;
            user-select: none;
            color: #fff;
            background: rgba(243,156,18,0.2);
        }
        .toggle-group input[type="radio"]:checked + label.present {
            background: #2ecc71;
        }
        .toggle-group input[type="radio"]:checked + label.absent {
            background: #e74c3c;
        }
        .toggle-group label:hover {
            transform: scale(1.08);
        }

        .table-wrapper::-webkit-scrollbar {
            width: 12px;
        }
        .table-wrapper::-webkit-scrollbar-thumb {
            background-color: rgba(243,156,18,0.7);
            border-radius: 10px;
        }
        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }
        .pagination button {
            padding: 6px 12px;
            border-radius: 20px;
            border: none;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            font-weight: bold;
            color: #fff;
            transition: all 0.3s ease;
        }
        .pagination button:hover { background: rgba(255,255,255,0.35); transform: scale(1.05);}
        .pagination button.active { background: #f39c12; color: #fff; }

        .submit-btn {
            margin-top: 20px;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            background: #f39c12;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin-left: auto;
            margin-right: auto;
            font-size: 1rem;
        }
        .submit-btn:hover {
            background: #e67e22;
            transform: scale(1.05);
        }

        /* Success popup */
        .success-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: #fff;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(-50px);
            animation: popupSlide 0.6s forwards;
            z-index: 999;
        }
        @keyframes popupSlide {
            0% { opacity: 0; transform: translateY(-50px);}
            50% { opacity: 1; transform: translateY(0);}
            100% { opacity: 1; transform: translateY(0);}
        }
    </style>
</head>
<body class="home-page">

<ul class="bubbles">
    <li></li><li></li><li></li><li></li><li></li>
    <li></li><li></li><li></li><li></li><li></li>
</ul>

<div class="card">
    <h1>CR ATTENDANCE DASHBOARD</h1>

    <!-- Date and Subject selectors -->
    <div class="selectors">
        
        {% for sub in ["MATHEMATICS","PUNJABI","PYTHON","ELECTRONICS","CHEMISTRY","ENGLISH"] %}
            <div class="subject-pill" data-sub="{{ sub }}">{{ sub }}</div>
        {% endfor %}
    </div>

    <!-- Attendance table -->
    <form method="POST" action="/cr/dashboard" id="attendance-form">
        <input type="date" name="attendance_date" id="attendance_date" required>
<input type="hidden" name="subject" id="subject-input">

        <!-- HIDDEN INPUT TO PRESERVE SUBJECT FOR FORM SUBMISSION -->
        <input type="hidden" name="subject" id="subject-input">

        <div class="table-wrapper">
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>ROLL NO</th>
                        <th>STUDENT NAME</th>
                        <th>STATUS</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                {% for roll, name in students.items() %}
                    <tr>
                        <td>{{ roll }}</td>
                        <td>{{ name }}</td>
                        <td>
                            <div class="toggle-group">
                                <input type="radio" id="p{{ roll }}" name="status_{{ roll }}" value="Present" checked>
                                <label for="p{{ roll }}" class="present">PRESENT</label>

                                <input type="radio" id="a{{ roll }}" name="status_{{ roll }}" value="Absent">
                                <label for="a{{ roll }}" class="absent">ABSENT</label>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <button type="submit" class="submit-btn">SUBMIT ATTENDANCE</button>
    </form>

    <div class="pagination" id="pagination"></div>
</div>
<style>
    /* ===== COMMON GLASS UI ===== */
.glass {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(18px);
    border-radius: 25px;
    padding: 25px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.35);
    animation: fadeUp 0.8s ease;
}

@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(25px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
/* ===== BUTTON STYLE ===== */
.btn {
    padding: 12px 22px;
    border-radius: 18px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    background: #f39c12;
    color: #000;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
}

</style>
<script>
    // Pagination
    const rows = document.querySelectorAll('#table-body tr');
    const rowsPerPage = 10;
    let currentPage = 1;
    const totalPages = Math.ceil(rows.length / rowsPerPage);

    function showPage(page) {
        currentPage = page;
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        rows.forEach((row, idx) => row.style.display = (idx >= start && idx < end) ? '' : 'none');

        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.classList.toggle('active', i === currentPage);
            btn.addEventListener('click', () => showPage(i));
            pagination.appendChild(btn);
        }
    }
    showPage(1);

    // Animate row when status changed
    document.querySelectorAll('.toggle-group input').forEach(input => {
        input.addEventListener('change', function() {
            const tr = this.closest('tr');
            tr.classList.add('marked');
            setTimeout(() => tr.classList.remove('marked'), 500);
        });
    });

    // Subject pill selection
    const pills = document.querySelectorAll('.subject-pill');
    let selectedSubject = null;
    pills.forEach(pill => {
        pill.addEventListener('click', () => {
            pills.forEach(p => p.classList.remove('active'));
            pill.classList.add('active');
            selectedSubject = pill.dataset.sub;

            // âœ… This line fixes submission issue
            document.getElementById('subject-input').value = selectedSubject;
        });
    });

    // Submit form with popup
    const form = document.getElementById('attendance-form');
    form.addEventListener('submit', (e) => {
        if(!selectedSubject) {
            e.preventDefault();
            alert("Please select a subject!");
            return;
        }
        if(!document.getElementById('attendance_date').value) {
            e.preventDefault();
            alert("Please select a date!");
            return;
        }
        // Show success popup after submission
        const popup = document.createElement('div');
        popup.className = 'success-popup';
        popup.innerText = 'Attendance submitted successfully!';
        document.body.appendChild(popup);
        setTimeout(() => popup.remove(), 2000);
    });

    // ===== PREMIUM ANIMATIONS JS =====

    const buttons = document.querySelectorAll('.btn.glass');

    // ===== CURSOR TRAIL =====
    document.addEventListener('mousemove', e => {
        const trail = document.createElement('span');
        trail.className = 'cursorTrail';
        trail.style.left = e.clientX + 'px';
        trail.style.top = e.clientY + 'px';
        document.body.appendChild(trail);
        setTimeout(() => trail.remove(), 500);
    });

    // ===== FLOATING BACKGROUND SPARKLES =====
    for(let i=0;i<20;i++){
        const sparkle = document.createElement('div');
        sparkle.className = 'floatingSparkle';
        sparkle.style.left = Math.random()*window.innerWidth + 'px';
        sparkle.style.top = Math.random()*window.innerHeight + 'px';
        sparkle.style.width = sparkle.style.height = (Math.random()*4 + 2) + 'px';
        sparkle.style.opacity = Math.random()*0.5 + 0.2;
        document.body.appendChild(sparkle);
    }

    // ===== BUTTON EFFECTS =====
    buttons.forEach(btn => {

        // Magnetic hover
        btn.addEventListener('mousemove', e => {
            const rect = btn.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;
            btn.style.transform = `translate(${x*0.15}px, ${y*0.15}px) scale(1.08) rotateZ(1deg)`;
            btn.style.boxShadow = `0 0 30px rgba(255,200,120,0.8), ${x*0.5}px ${y*0.5}px 40px rgba(255,255,255,0.2)`;
        });

        btn.addEventListener('mouseleave', () => {
            btn.style.transform = 'translate(0,0) scale(1) rotateZ(0deg)';
            btn.style.boxShadow = '0 0 30px rgba(255,200,120,0.8)';
        });

        // Click particles + confetti
        btn.addEventListener('click', e => {
            for(let i=0;i<12;i++){
                const particle = document.createElement('span');
                particle.className = 'clickParticle confettiPiece';
                particle.style.left = e.clientX + 'px';
                particle.style.top = e.clientY + 'px';
                particle.style.setProperty('--dx', (Math.random()*100-50)+'px');
                particle.style.setProperty('--dy', (Math.random()*100-50)+'px');
                particle.style.background = `hsl(${Math.random()*50+30}, 100%, 50%)`;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 600);
            }
        });

        // Micro floating particles on hover
        btn.addEventListener('mouseenter', () => {
            for(let i=0;i<5;i++){
                const micro = document.createElement('span');
                micro.className = 'microParticle';
                const rect = btn.getBoundingClientRect();
                micro.style.left = rect.left + Math.random()*rect.width + 'px';
                micro.style.top = rect.top + Math.random()*rect.height + 'px';
                document.body.appendChild(micro);
                setTimeout(()=>micro.remove(), 1000);
            }
        });

    });

    // Add floating particles dynamically on all pages
    for(let i=0;i<30;i++){
        const fp = document.createElement('div');
        fp.className = 'floatingParticle';
        fp.style.left = Math.random()*window.innerWidth + 'px';
        fp.style.top = Math.random()*window.innerHeight + 'px';
        fp.style.width = fp.style.height = (Math.random()*4+2) + 'px';
        document.body.appendChild(fp);
    }
    <div style="position:fixed; top:20px; right:20px; z-index:1000;">
    <a href="/logout" class="btn glass ripple">ðŸšª Logout</a>
</div>
</script>
<head> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

</body>
</html>
